# ***************************************************************
#	Top-level Makefile for PSUADE.
# ***************************************************************

include config/mh-machine

SRCDIR 	   = Src
TSTDIR     = Examples
BINDIR     = bin
PYDIR      = Python

CSHARE    = -fPIC
FSHARE    = -fPIC
CXXSHARE  = -fPIC

main: lib 
	@(cd $(SRCDIR)/Main; make)

so: libso 
	@(cd $(SRCDIR)/Main; make so \
              CXXFLAGS="$(CXXFLAGS) $(CXXSHARE) $(INCPYTH)")

lib:
	@(cd $(SRCDIR); \
         make ARCH="$(ARCH)" CC="$(CC)" CXX="$(CXX)" F77="$(F77)" \
              AR="$(AR)" RANLIB="$(RANLIB)" PLOT_LIB="$(PLOT_LIB)" \
              CFLAGS="$(CFLAGS)" FFLAGS="$(FFLAGS)" CXXFLAGS="$(CXXFLAGS)" \
              DEFINES="$(DEFINES)" $(TARGET))
	@(cd External/Bose; make)
	@(cd External/Lapack; make)
	$(MAKE_MARS)
	$(MAKE_EARTH)
	$(MAKE_TXMATH)
	$(MAKE_MINPACK)
	$(MAKE_COBYLA)
	$(MAKE_APPSPACK)
	$(MAKE_SNNS)
	$(MAKE_TPROS)
	$(MAKE_GPMC)
	$(MAKE_METIS)
	$(MAKE_SVM)
	$(MAKE_TGP)
	$(MAKE_R)
	$(MAKE_BOBYQA)

libso:
	@(cd $(SRCDIR); \
         make ARCH="$(ARCH)" CC="$(CC)" CXX="$(CXX)" F77="$(F77)" \
              AR="$(AR)" RANLIB="$(RANLIB)" PLOT_LIB="$(PLOT_LIB)" \
              CFLAGS="$(CFLAGS) $(CSHARE)" FFLAGS="$(FFLAGS) $(FSHARE)" \
              CXXFLAGS="$(CXXFLAGS) $(CXXSHARE) -DHAVE_PYTHON $(INCPYTH)" \
              HAVE_PYTH=1 DEFINES="$(DEFINES)" $(TARGET))
	@(cd External/Bose; make CFLAGS="$(CFLAGS) $(CSHARE)")
	@(cd External/Lapack; make FFLAGS="$(FFLAGS) $(FSHARE)")
	$(MAKE_MARS_SO)
	$(MAKE_EARTH_SO)
	$(MAKE_TXMATH_SO)
	$(MAKE_MINPACK_SO)
	$(MAKE_COBYLA_SO)
	$(MAKE_APPSPACK_SO)
	$(MAKE_SNNS_SO)
	$(MAKE_TPROS_SO)
	$(MAKE_GPMC_SO)
	$(MAKE_METIS_SO)
	$(MAKE_SVM_SO)
	$(MAKE_TGP_SO)
	$(MAKE_R_SO)
	$(MAKE_BOBYQA_SO)

test:
	@(cd $(TSTDIR); \
         make ARCH=$(ARCH) CC="$(CC)" CXX="$(CXX)" F77="$(F77)" \
              AR="$(AR)" RANLIB="$(RANLIB)" PLOT_LIB="$(PLOT_LIB)" \
              MISC_LIB="$(MISC_LIB)" WIN_LIB="$(WIN_LIB)" CFLAGS="$(CFLAGS)" \
              FFLAGS="$(FFLAGS)" CXXFLAGS="$(CXXFLAGS)")

clean:
	@(cd $(SRCDIR); make ARCH=$(ARCH) clean)
	@(cd $(TSTDIR); make clean)
	@(cd $(BINDIR); make clean)
	@(cd $(PYDIR);  make clean)
	@(cd External/Bose; make clean)
	@(cd External/Lapack; make clean)
	$(CLEAN_MARS)
	$(CLEAN_EARTH)
	$(CLEAN_MINPACK)
	$(CLEAN_COBYLA)
	$(CLEAN_TXMATH)
	$(CLEAN_APPSPACK)
	$(CLEAN_SNNS)
	$(CLEAN_TPROS)
	$(CLEAN_GPMC)
	$(CLEAN_METIS)
	$(CLEAN_SVM)
	$(CLEAN_TGP)
	$(CLEAN_R)
	$(CLEAN_BOBYQA)
	rm -f Makefile config.log

reallyclean: clean
	@(cd $(SRCDIR); make ARCH=$(ARCH) clean)
	@(cd $(TSTDIR); make clean)
	@(cd $(BINDIR); make clean)
	@(cd External/Bose; make realclean)
	@(cd External/Lapack; make realclean)
	$(CLEAN_MARS)
	$(CLEAN_EARTH)
	$(CLEAN_MINPACK)
	$(CLEAN_COBYLA)
	$(CLEAN_TXMATH)
	$(CLEAN_APPSPACK)
	$(CLEAN_SNNS)
	$(CLEAN_TPROS)
	$(CLEAN_GPMC)
	$(CLEAN_METIS)
	$(CLEAN_SVM)
	$(CLEAN_TGP)
	$(CLEAN_R)
	$(CLEAN_BOBYQA)
	@rm -f Makefile

release: clean
	(cd ..; tar -cf psuade.tar PSUADE_dev; compress psuade.tar)
	@echo "==== > PSUADE make release complete"

